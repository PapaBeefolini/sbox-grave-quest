@using Sandbox.UI;
@using Sandbox.Events;

@namespace MightyBrick.GraveQuest.UI
@inherits PanelComponent
@implements IGameEventHandler<PizzaThrownEvent> 
@implements IGameEventHandler<SkeletonDiedEvent>

<root>
    <Score @ref="ScorePanel"/>
    @if (GameManager.Instance.IsCountdownActive)
    {
        string text = CurrentTime.ToString();
        if (CurrentTime == 0)
            text = "GO!";
        <CountDown Text=@text/>
    }
    <Timer CurrentTime=@CurrentTime></Timer>
    <Pizza @ref="PizzaPanel"/>
</root>

@code
{
    public int CurrentTime { get; set; } = 0;
    public Score ScorePanel { get; set; }
    public Pizza PizzaPanel { get; set; }

    protected override void OnUpdate()
    {
        CurrentTime = MathX.FloorToInt(1 + GameManager.Instance.TimeUntilGameStart.Relative);
    }

    public void OnGameEvent(PizzaThrownEvent args)
    {
        if (!PizzaPanel.IsValid())
            return;
        PizzaPanel.Animate();
    }

    public void OnGameEvent(SkeletonDiedEvent args)
    {
        if (!ScorePanel.IsValid())
            return;
        ScorePanel.Increment();
    }

    protected override int BuildHash() => System.HashCode.Combine(CurrentTime);
}
