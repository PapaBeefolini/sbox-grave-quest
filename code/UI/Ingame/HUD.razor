@using Sandbox.UI;
@using Sandbox.Events;

@namespace MightyBrick.GraveQuest.UI
@inherits PanelComponent
@implements IGameEventHandler<PizzaThrownEvent> 
@implements IGameEventHandler<SkeletonDiedEvent>

<root>
    <Announcement @ref="Announcement"/>
    <Score @ref="ScorePanel"/>
    <Timer CurrentTime=@CurrentTime></Timer>
    <Pizza @ref="PizzaPanel"/>
</root>

@code
{
    public Announcement Announcement { get; set; }
    public Score ScorePanel { get; set; }
    public Pizza PizzaPanel { get; set; }
    public int CurrentTime { get; set; } = 0;

    protected override void OnUpdate()
    {
        //CurrentTime = MathX.FloorToInt(1 + GameManager.Instance.TimeUntilGameStart.Relative);
    }

    public void Announce(string text, float timeVisible)
    {
        if (!Announcement.IsValid())
            return;
        Announcement.Display(text, timeVisible);
    }

    public void OnGameEvent(PizzaThrownEvent args)
    {
        if (!PizzaPanel.IsValid())
            return;
        PizzaPanel.Animate();
    }

    public void OnGameEvent(SkeletonDiedEvent args)
    {
        if (!ScorePanel.IsValid())
            return;
        ScorePanel.Increment();
    }

    protected override int BuildHash() => System.HashCode.Combine(CurrentTime);
}
