@using Sandbox.UI;
@using Sandbox.Events;

@namespace MightyBrick.GraveQuest.UI
@inherits PanelComponent
@implements IGameEventHandler<PizzaThrownEvent> 
@implements IGameEventHandler<SkeletonDiedEvent>

<root>
    <Announcement @ref="Announcement"/>
    <Timer @ref="TimePanel" CurrentTime=@MathX.FloorToInt(GameManager.Instance.TimeRemaining + 1)></Timer>
    <Score @ref="ScorePanel"/>
    <Pizza @ref="PizzaPanel"/>
</root>

@code
{
    public Announcement Announcement { get; set; }
    public Timer TimePanel { get; set; }
    public Score ScorePanel { get; set; }
    public Pizza PizzaPanel { get; set; }

    public void Announce(string text, float timeVisible)
    {
        if (!Announcement.IsValid())
            return;
        Announcement.Display(text, timeVisible);
    }

    public void OnGameEvent(PizzaThrownEvent args)
    {
        if (!PizzaPanel.IsValid())
            return;
        PizzaPanel.Animate();
    }

    public void OnGameEvent(SkeletonDiedEvent args)
    {
        if (!ScorePanel.IsValid())
            return;
        ScorePanel.Animate();
        if (!TimePanel.IsValid())
            return;
        TimePanel.Animate();
    }

    protected override int BuildHash() => System.HashCode.Combine(GameManager.Instance.TimeRemaining);
}
